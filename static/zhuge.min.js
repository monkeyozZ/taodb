!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i=t();for(var n in i)("object"==typeof exports?exports:e)[n]=i[n]}}(window,function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var u=t[n]={i:n,l:!1,exports:{}};return e[n].call(u.exports,u,u.exports,i),u.l=!0,u.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var u in e)i.d(n,u,function(t){return e[t]}.bind(null,u));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=2)}([function(e,t){var i=Array.prototype,n=Object.prototype,u=i.slice,r=n.hasOwnProperty,o=i.forEach,s={};e.exports={uuid:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},each:function(e,t,i){if(null!=e)if(o&&e.forEach===o)e.forEach(t,i);else if(e.length===+e.length){for(var n=0,u=e.length;n<u;n++)if(n in e&&t.call(i,e[n],n,e)===s)return}else for(var c in e)if(r.call(e,c)&&t.call(i,e[c],c,e)===s)return},extend:function(e){return this.each(u.call(arguments,1),function(t){for(var i in t)void 0!==t[i]&&(e[i]=t[i])}),e},isUndefined:function(e){return void 0===e},isString:function(e){return"[object String]"==Object.prototype.toString.call(e)},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isFunction:function(e){try{return/^\s*\bfunction\b/.test(e)}catch(e){return!1}},isObject:function(e){return e===Object(e)&&!this.isArray(e)},getSystemInfo:function(){var e=wx.getSystemInfoSync();return e.resolution=e.windowWidth+"x"+e.windowHeight,e},encode:function(e){var t={};for(var i in e)t["_"+i]=e[i];return t},getNet:function(e){wx.getNetworkType({complete:function(t){var i="wifi"===t.networkType?1:0,n="wifi"===t.networkType?0:{"2g":1,"3g":3,"4g":13}[t.networkType];e&&e({net:i,mnet:n})}})},deleteQueryParams:function(e,t){var i=[];return e.split("&").forEach(function(e){let n=new RegExp(t+"=.*");var u="";n.test(e)?(u=e.replace(n,""))&&i.push(u):i.push(e)}),i.join("&")},addQueryParams:function(e,t){var i="";for(var n in t)i&&(i+="&"),e=this.deleteQueryParams(e,n),i+=n+"="+t[n];var u=e.split("?");return u.length>1?u[1]?u[1]=i+"&"+u[1]:u[1]=i:1===u.length&&u.push(i),u.join("?")}}},function(e,t,i){var n=i(0);e.exports={key:"zg",get:function(e){var t=this.getAll();return t?t[e]:null},set:function(e,t){var i=this.getAll();i[e]=t,wx.setStorageSync(this.key,i)},setUtm:function(e){wx.setStorageSync("utm",e)},getUtm:function(){return wx.getStorageSync("utm")},del:function(e){var t=this.getAll();delete t[e],wx.setStorageSync(this.key,t)},getAll:function(){var e=wx.getStorageSync(this.key);return e||(e={cache:[],ec:0},wx.setStorageSync(this.key,e)),e},clear:function(){var e=wx.getStorageSync(this.key);e.cache=[],e.ec=0,wx.setStorageSync(this.key,e)},getDid:function(){return wx.getStorageSync("zg-did")},registerDid:function(e){wx.setStorageSync("zg-did",e||n.uuid())},updateSession:function(e,t,i){if(!e)return;let n=wx.getStorageSync("zg-session");n?(n.sid=e,n.active=t):n={sid:e,active:t},console.log(i+"set session info is "+JSON.stringify(n)),wx.setStorageSync("zg-session",n)},getSessionInfo:function(){return wx.getStorageSync("zg-session")},flush:function(e){for(var t=this.get("sid"),i=e||this.get("cache"),n=0,u=i.length;n<u;n++){var r=i[n];r.pr.hasOwnProperty("$sid")||(r.pr.$sid=t)}return this.set("cache",[]),i}}},function(e,t,i){var n=i(0),u=i(1),r=i(3),o=new(i(4)),s=!1;function c(e,t,i){if(e[t]){var n=e[t];e[t]=function(){n.apply(this,arguments),i.apply(this,arguments)}}else e[t]=i}function m(e,t){var i=e||{},n=t||{};return["utm_source","utm_medium","utm_campaign","utm_content","utm_term"].forEach(function(e){i[e]?n["$"+e]=i[e]:i["$"+e]&&(n["$"+e]=i["$"+e])}),n}function a(e){var t="";e.data&&e.data.title&&e.data.title.length>0&&(t=Array.isArray(e.data.title)?e.data.title.join(" "):e.data.title);try{if(!t.length&&__wxConfig&&(__wxConfig.tabBar&&__wxConfig.tabBar.list.forEach(i=>{i.pagePath===`${e.route}.html`&&i.text&&(t=i.text)}),!t.length)){var i=__wxConfig.page[e.route]||__wxConfig.page[`${e.route}.html`];t=i?i.window.navigationBarTitleText:__wxConfig.global.window.navigationBarTitleText}}catch(e){console.log(e)}return t||e.route}var d=function(){App.zgGlobalData={}},g=function(e){App.zgGlobalData.zgCachePageOptions=e;let t=function(e){if(!e||!e.scene)return console.log("scene is null "),null;let t=e.scene,i=t.toString();o._props.cn=i;let n,u,s=r[i];if(r.isShare(t)&&(u=e.referrerInfo.appId),s){n={utm_source:s.utm_source,utm_medium:s.utm_medium,utm_campaign:u};let i=e.query;r.isCartShare(t)&&i.zg_uid&&i.zg_share_id&&(n.utm_term=i.zg_uid,n.utm_content=i.zg_share_id)}let c=m(n);return m(e.query,c)}(e),i=t||{},n=u.getSessionInfo();if(n&&n.hasOwnProperty("active")){let e=(new Date).getTime();e-n.active>3e4?(u.setUtm(i),o.end(),o.start()):(t&&u.setUtm(t),u.set("sid",n.sid),u.updateSession(n.sid,e,"进入应用"))}else u.setUtm(i),o.start()},_=function(){let e=u.get("sid"),t=(new Date).getTime();u.updateSession(e,t,"应用退出")},p=function(e){let t=e||{},i=Object.keys(t),n=o._config.usePlugin?this.$mp.page.route:this.__route__,r=n,s=[];if(i&&i.length>0){n+="?";for(let t=0;t<i.length;t++){let n=i[t];s[t]=n+"="+e[n]}n+=s.join("&")}if(u.set("$url",n),!o._config.pv)return;let c={$page_title:r};o.privateTrack("pv",c,!1)},f=function(){let e=u.get("sid"),t=new Date;if(u.updateSession(e,t.getTime(),"pageShow"),!App.zgGlobalData||!App.zgGlobalData.zgCachePageOptions)return void console.log("zg无法获取分享基础数据",App.zgGlobalData);let i=App.zgGlobalData.zgCachePageOptions,n=i.query;console.log("options.scene:",i.scene),s?s=!1:o._config.forwardShare&&r.isCartShare(i.scene)&&n.zg_uid&&n.zg_share_id&&o.privateTrack("wxsopen",{$uid:n.zg_uid,$share_id:n.zg_share_id,$title:a(this),$path:u.get("$url")})},l=function(){};let h=App,y=Page,v={App:function(e){return c(e,"onLaunch",d),c(e,"onShow",g),c(e,"onHide",_),o._config.usePlugin||h(e),e},Page:function(e){if(c(e,"onLoad",p),c(e,"onShow",f),c(e,"onHide",l),o._config.forwardShare){var t=e.onShareAppMessage;e.onShareAppMessage=function(){var e={};n.isFunction(t)&&(e=t.apply(this,arguments)||{});var i=a(this),r=e.title||i,c=e.path||u.get("$url"),m=(new Date).getTime();return c=n.addQueryParams(c,{zg_share_id:m,zg_uid:u.get("cuid")||u.getDid()}),console.log("share path:",c),o.privateTrack("wxshare",{$uid:u.get("cuid")||u.getDid(),$share_id:m,$share_title:r,$title:i||"",$path:c||""}),s=!0,e.title=r,e.path=c,e}}return o._config.usePlugin||y(e),e}};o.mergeGlobalObj=function(){var e=__wxConfig&&__wxConfig.plugins&&Object.getOwnPropertyNames(__wxConfig.plugins);console.log(o._config.usePlugin||e),o._config.usePlugin||e?console.log("已经启用诸葛sdk插件模式"):(App=v.App,Page=v.Page)},App.zhuge=o,v.App.zhuge=o,v.Page.zhuge=o,v.zhuge=o,e.exports=v},function(e,t){e.exports={1044:{utm_source:"分享",utm_medium:"带shareTicket的小程序消息卡片（详情）"},1007:{utm_source:"分享",utm_medium:"单人聊天会话中的小程序消息卡片"},1008:{utm_source:"分享",utm_medium:"群聊会话中的小程序消息卡片"},1036:{utm_source:"分享",utm_medium:"App分享消息卡片"},1020:{utm_source:"公众号",utm_medium:"公众号profile页相关小程序列表"},1035:{utm_source:"公众号",utm_medium:"公众号自定义菜单"},1043:{utm_source:"公众号",utm_medium:"公众号模板消息"},1058:{utm_source:"公众号",utm_medium:"公众号文章"},1074:{utm_source:"公众号会话",utm_medium:"公众号会话下发的小程序消息卡片"},1067:{utm_source:"广告",utm_medium:"公众号文章广告"},1068:{utm_source:"广告",utm_medium:"附近小程序列表广告"},1073:{utm_source:"客服消息",utm_medium:"客服消息列表下发的小程序消息卡片"},1011:{utm_source:"扫码",utm_medium:"扫描二维码"},1012:{utm_source:"扫码",utm_medium:"长按图片识别二维码"},1013:{utm_source:"扫码",utm_medium:"手机相册选取二维码"},1025:{utm_source:"扫码",utm_medium:"扫描一维码"},1031:{utm_source:"扫码",utm_medium:"长按图片识别一维码"},1032:{utm_source:"扫码",utm_medium:"手机相册选取一维码"},1047:{utm_source:"扫码",utm_medium:"扫描小程序码"},1048:{utm_source:"扫码",utm_medium:"长按图片识别小程序码"},1049:{utm_source:"扫码",utm_medium:"手机相册选取小程序码"},1027:{utm_source:"搜索",utm_medium:"顶部搜索框搜索结果页“使用过的小程序”列表"},1005:{utm_source:"搜索",utm_medium:"顶部搜索框的搜索结果页"},1006:{utm_source:"搜索",utm_medium:"发现栏小程序主入口搜索框的搜索结果页"},1042:{utm_source:"搜索",utm_medium:"添加好友搜索框的搜索结果页"},1053:{utm_source:"搜索",utm_medium:"搜一搜的结果页"},1054:{utm_source:"搜索",utm_medium:"顶部搜索框小程序快捷入口"},1064:{utm_source:"微信WIFI",utm_medium:"微信连Wi-Fi状态栏"},1078:{utm_source:"微信WIFI",utm_medium:"连Wi-Fi成功页"},1028:{utm_source:"微信卡券",utm_medium:"我的卡包"},1029:{utm_source:"微信卡券",utm_medium:"卡券详情页"},1052:{utm_source:"微信卡券",utm_medium:"卡券的适用门店列表"},1019:{utm_source:"微信支付",utm_medium:"微信钱包"},1034:{utm_source:"微信支付",utm_medium:"微信支付完成页"},1057:{utm_source:"微信支付",utm_medium:"钱包中的银行卡详情页"},1071:{utm_source:"微信支付",utm_medium:"钱包中的银行卡列表页"},1072:{utm_source:"微信支付",utm_medium:"二维码收款页面"},1001:{utm_source:"微信主程序",utm_medium:"发现栏小程序主入口"},1022:{utm_source:"微信主程序",utm_medium:"聊天顶部置顶小程序入口"},1024:{utm_source:"微信主程序",utm_medium:"小程序 profile 页"},1089:{utm_source:"微信主程序",utm_medium:"微信聊天主界面下拉"},1026:{utm_source:"微信主程序",utm_medium:"附近小程序列表"},1037:{utm_source:"小程序",utm_medium:"小程序打开小程序"},1038:{utm_source:"小程序",utm_medium:"从另一个小程序返回"},1090:{utm_source:"小程序",utm_medium:"长按小程序右上角菜单唤出最近使用历史"},1014:{utm_source:"小程序模板消息",utm_medium:"小程序模板消息"},1039:{utm_source:"摇电视",utm_medium:"摇电视"},1056:{utm_source:"音乐播放器菜单",utm_medium:"音乐播放器菜单"},1023:{utm_source:"桌面图标",utm_medium:"安卓系统桌面图标"},1017:{utm_source:"体验版",utm_medium:"前往体验版的入口页"},1030:{utm_source:"测试",utm_medium:"自动化测试下打开小程序"},1059:{utm_source:"体验版",utm_medium:"体验版小程序绑定邀请页"},1092:{utm_source:"微信城市服务",utm_medium:"城市服务入口"},1091:{utm_source:"公众号",utm_medium:"公众号文章商品卡片"},1095:{utm_source:"广告",utm_medium:"小程序广告组件"},1096:{utm_source:"分享",utm_medium:"聊天记录"},1097:{utm_source:"微信支付",utm_medium:"微信支付签约页"},1099:{utm_source:"小程序",utm_medium:"页面内嵌插件"},1102:{utm_source:"公众号",utm_medium:"公众号profile页服务预览"},1081:{utm_source:"客服消息",utm_medium:"客服消息下发的文字链"},1082:{utm_source:"公众号",utm_medium:"公众号会话下发的文字链"},1084:{utm_source:"广告",utm_medium:"朋友圈广告原生页"},1077:{utm_source:"摇周边",utm_medium:"摇周边"},1069:{utm_source:"移动应用",utm_medium:"移动应用"},1045:{utm_source:"广告",utm_medium:"朋友圈广告"},1046:{utm_source:"广告",utm_medium:"朋友圈广告详情页"},1079:{utm_source:"微信游戏中心",utm_medium:"微信游戏中心"},isShare:function(e){return-1!==[1020,1035,1036,1037,1038,1043].indexOf(e)},isCartShare:function(e){return-1!==[1044,1007,1008,1036].indexOf(e)}}},function(e,t,i){var n=i(0),u=i(1),r=function(){this._props={appKey:"",br:"wx-app",an:"",vn:"",cn:""},this._urlOrigin={normal:"https://u.zhugeapi.net",bac:"https://ubak.zhugeio.com"},this._config={debug:!1,did:"",an:"wxApp",vn:"1.0",pv:!1,wxeid:"",forwardShare:!1,usePlugin:!1},this._sdk="web",this._sdkv="2.4.5"};r.prototype._registerOnce=function(){u.getDid()||u.registerDid(this._config.did)},r.prototype._sendRequest=function(e){var t=u.get("cache");if(!u.get("sid")||!u.get("appKey"))return t.push(e),void u.set("cache",t);var i=new Date,n={method:"web_event_srv.upload",event:{sln:"itn",pl:"js",sdk:"zg-js",sdkv:this._sdkv,owner:"zg",ut:[i.getFullYear(),i.getMonth()+1,i.getDate()].join("-")+" "+i.toTimeString().match(/\d{2}:\d{2}:\d{2}/)[0],tz:6e4*-i.getTimezoneOffset(),debug:this._config.debug?1:0,ak:this._props.appKey,usr:{did:u.getDid()},data:[]},_:(new Date).getTime().toString()};if(t.length){let e=u.flush(t);n.event.data=n.event.data.concat(e)}n.event.data.push(e),this._request(n)},r.prototype._request=function(e){var t=this;wx.request({url:this._urlOrigin.normal+"/web_event",data:e,responseType:"arraybuffer",fail:function(i){t._urlOrigin.normal.toUpperCase()===t._urlOrigin.bac.toUpperCase()||wx.request({url:t._urlOrigin.bac+"/web_event",data:e,responseType:"arraybuffer"})}})},r.prototype._info=function(){var e=n.getSystemInfo(),t=new Date,i={dt:"pl",pr:{$rs:e.resolution,$tz:6e4*-t.getTimezoneOffset(),$ct:t.getTime(),$cuid:u.get("cuid")}};this._sendRequest(i)},r.prototype._sessionStart=function(){var e=new Date,t=e.getTime(),i=n.getSystemInfo(),r=this;u.set("sid",t),u.updateSession(t,t,"会话开始"),n.getNet(function(o){var s={dt:"ss",pr:{$ct:e.getTime(),$sid:t,$cuid:u.get("cuid"),$cn:r._props.cn,$tz:6e4*-e.getTimezoneOffset(),$url:u.get("$url"),$os:i.system.split(/\s/)[0],$ov:i.system.split(/\s/)[1],$wv:i.version,$mnet:o.mnet,$net:o.net,$vn:r._props.vn,$referrer_domain:"miniprogram",$wxeid:r._config.wxeid}};s.pr=n.extend(s.pr,u.getUtm()),r._sendRequest(s)})},r.prototype._sessionEnd=function(){var e=u.get("sid"),t=new Date,i=t.getTime()-e,r={dt:"se",pr:{$ct:t.getTime(),$cn:this._props.cn,$tz:6e4*-t.getTimezoneOffset(),$dru:i,$sid:e,$cuid:u.get("cuid"),$referrer_domain:"miniprogram"}};r.pr=n.extend(r.pr,u.getUtm()),this._sendRequest(r),u.clear()},r.prototype._init=function(){this._registerOnce(),this._sessionStart(),this._info()},r.prototype.weixinIdentify=function(){var e=this._config.wxeid;arguments[0]&&"string"==typeof arguments[0]&&(e=arguments[0]);var t=this._urlOrigin.normal,i="",n="",u="",r="",o="",s="",c="";let m=[function(e){wx.login({success:t=>{i=t.code,e&&e()},fail:function(e){console.log("诸葛SDK提示：","登录失败",e)}})},function(e){wx.getSetting({success:t=>{t.authSetting["scope.userInfo"]?wx.getUserInfo({lang:"zh_CN",success:t=>{o=t.userInfo,s=t.iv,c=t.encryptedData,e&&e()}}):console.log("诸葛SDK提示：","未授权",t)}})},function(o){var s=this,c={url:t+"/zgwx/user/code2session",method:"GET",data:{code:i,appId:e},success:e=>{n=e.data.openid,u=e.data.unionid,r=e.data.session_key,o&&o()},fail:function(e){t!==s._urlOrigin.bac?(c.url=s._urlOrigin.bac+"/zgwx/user/code2session",wx.request(c)):console.log("诸葛SDK提示：","获取codeSession失败",e)}};wx.request(c)},function(e){var i=this,n={url:t+"/zgwx/data/decrypt",method:"POST",data:{sessionKey:r,iv:s,encryptData:c},success:function(t){u=t.data.unionId,e&&e(t.data||{})},fail:function(e){t!==i._urlOrigin.bac?(n.url=i._urlOrigin.bac+"/zgwx/data/decrypt",wx.request(n)):console.log("诸葛SDK提示：","获取codeSession失败",e)}};wx.request(n)},function(e){let t="";switch(o.gender){case 1:t="男";break;case 2:t="女"}this.identify(u||n,{name:o.nickName,avatar:o.avatarUrl,"微信-昵称":o.nickName,"微信-性别":t,"微信-城市":o.city,"微信-省":o.province,"微信-国家":o.country}),e&&e()}],a=Array.prototype.pop.call(arguments);"function"==typeof a&&m.push(function(){a({userInfo:o,unionid:u,openid:n,sessionKey:r})}),function e(t,i,n){t.length<=n||t[n=n||0].call(i,function(){e(t,i,n+1)})}(m,this)},r.prototype.load=function(e,t){if(this._props.appKey=e,u.set("appKey",e),n.isObject(t)&&(this._config=n.extend(this._config,t),this._config.an&&(this._props.an=this._config.an),this._config.vn&&(this._props.vn=this._config.vn)),wx.getAccountInfoSync){let e=wx.getAccountInfoSync();e&&e.miniProgram&&e.miniProgram.appId&&(this._config.wxeid=e.miniProgram.appId)}n.isFunction(this.mergeGlobalObj)&&this.mergeGlobalObj()},r.prototype.identify=function(e,t){if(e&&0!=e.length){var i=u.get("sid"),r=new Date;u.set("cuid",e);var o={dt:"usr",pr:{$ct:r.getTime(),$tz:6e4*-r.getTimezoneOffset(),$cuid:e,$sid:i,$url:u.get("$url")}};n.isObject(t)&&(o.pr=n.extend(o.pr,n.encode(t))),this._sendRequest(o)}else console.error("identify uid不能为空")},r.prototype.track=function(e,t){e&&e.length>0?this.privateTrack(e,t,!0):console.error("track 事件名称不能为空")},r.prototype.privateTrack=function(e,t,i){var r=u.get("sid"),o=new Date,s=n.getSystemInfo(),c=i?"evt":"abp",m=this;i&&u.set("ec",u.get("ec")+1),i&&u.updateSession(r,o.getTime(),"标记事件"+c),n.getNet(function(a){var d={dt:c,pr:{$eid:e,$ct:o.getTime(),$tz:6e4*-o.getTimezoneOffset(),$cuid:u.get("cuid"),$cn:m._props.cn,$sid:r,$url:u.get("$url"),$os:s.system.split(/\s/)[0],$ov:s.system.split(/\s/)[1],$wv:s.version,$mnet:a.mnet+"",$referrer_domain:"miniprogram",$net:a.net+"",$vn:m._props.vn,$wxeid:m._config.wxeid}};if(d.pr=n.extend(d.pr,u.getUtm()),n.isObject(t)&&(d.pr=i?n.extend(d.pr,n.encode(t)):n.extend(d.pr,t)),r)m._sendRequest(d);else{let e=u.get("cache");e.push(d),u.set("cache",e)}})},r.prototype.start=function(){this._init()},r.prototype.end=function(){this._sessionEnd()},e.exports=r}])});